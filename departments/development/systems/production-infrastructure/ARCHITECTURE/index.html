
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://minor-league-esports.github.io/knowledgeBase/departments/development/systems/production-infrastructure/ARCHITECTURE/">
      
      
        <link rel="prev" href="../CONTEXT_SUMMARY/">
      
      
        <link rel="next" href="../GLOSSARY/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Architecture - Knowledge Base</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="yellow" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sprocket-infrastructure-architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Knowledge Base" class="md-header__button md-logo" aria-label="Knowledge Base" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Knowledge Base
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architecture
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/minor-league-esports/knowledgeBase" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Knowledge Base" class="md-nav__button md-logo" aria-label="Knowledge Base" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Knowledge Base
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/minor-league-esports/knowledgeBase" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Departments
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Departments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../rocket-league-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rocket League Operations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../trackmania-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trackmania Operations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../community/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Community
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../new-team-members/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    New Team Members
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4_3" id="__nav_2_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Systems
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4_3">
            <span class="md-nav__icon md-icon"></span>
            Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../systems-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modmail/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modmail KB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sprocket-identity-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sprocket Identity System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_3_4" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4_3_4" id="__nav_2_4_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Production Infrastructure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_4_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4_3_4">
            <span class="md-nav__icon md-icon"></span>
            Production Infrastructure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_3_4_2" >
        
          
          <label class="md-nav__link" for="__nav_2_4_3_4_2" id="__nav_2_4_3_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_2_4_3_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_3_4_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00-START-HERE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../README.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    README
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CONTEXT_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Context Summary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_3_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4_3_4_3" id="__nav_2_4_3_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture & Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_2_4_3_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture & Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Executive Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Executive Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#at-a-glance" class="md-nav__link">
    <span class="md-ellipsis">
      At a Glance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cost-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      Cost Breakdown
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#business-value" class="md-nav__link">
    <span class="md-ellipsis">
      Business Value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk-assessment" class="md-nav__link">
    <span class="md-ellipsis">
      Risk Assessment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scaling-timeline" class="md-nav__link">
    <span class="md-ellipsis">
      Scaling Timeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-technical-readers" class="md-nav__link">
    <span class="md-ellipsis">
      For Technical Readers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-youre-looking-at" class="md-nav__link">
    <span class="md-ellipsis">
      What You're Looking At
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infrastructure-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Infrastructure Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#high-level-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      High-Level Architecture
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-101-core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture 101: Core Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture 101: Core Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-docker" class="md-nav__link">
    <span class="md-ellipsis">
      What is Docker?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-docker-swarm" class="md-nav__link">
    <span class="md-ellipsis">
      What is Docker Swarm?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-infrastructure-as-code-iac" class="md-nav__link">
    <span class="md-ellipsis">
      What is Infrastructure as Code (IaC)?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-pulumi" class="md-nav__link">
    <span class="md-ellipsis">
      What is Pulumi?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-are-layers" class="md-nav__link">
    <span class="md-ellipsis">
      What Are Layers?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-are-networks" class="md-nav__link">
    <span class="md-ellipsis">
      What Are Networks?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-a-reverse-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      What is a Reverse Proxy?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-secrets-management" class="md-nav__link">
    <span class="md-ellipsis">
      What is Secrets Management?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-are-managed-services" class="md-nav__link">
    <span class="md-ellipsis">
      What Are Managed Services?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Principles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-infrastructure-as-code" class="md-nav__link">
    <span class="md-ellipsis">
      1. Infrastructure as Code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-layered-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      2. Layered Deployment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-managed-services-for-critical-components" class="md-nav__link">
    <span class="md-ellipsis">
      3. Managed Services for Critical Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-security-by-default" class="md-nav__link">
    <span class="md-ellipsis">
      4. Security by Default
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-observability-first" class="md-nav__link">
    <span class="md-ellipsis">
      5. Observability First
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#three-layer-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Three-Layer Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Three-Layer Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#layer-1-infrastructure-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      Layer 1: Infrastructure Foundation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-2-data-services" class="md-nav__link">
    <span class="md-ellipsis">
      Layer 2: Data Services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#platform-application-services" class="md-nav__link">
    <span class="md-ellipsis">
      Platform: Application Services
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-topology" class="md-nav__link">
    <span class="md-ellipsis">
      Network Topology
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Network Topology">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-swarm-overlay-networks" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Swarm Overlay Networks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-isolation-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Network Isolation Strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-catalog" class="md-nav__link">
    <span class="md-ellipsis">
      Service Catalog
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service Catalog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#layer-1-services" class="md-nav__link">
    <span class="md-ellipsis">
      Layer 1 Services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Layer 1 Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#traefik" class="md-nav__link">
    <span class="md-ellipsis">
      Traefik
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vault" class="md-nav__link">
    <span class="md-ellipsis">
      Vault
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#socket-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      Socket Proxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-2-services" class="md-nav__link">
    <span class="md-ellipsis">
      Layer 2 Services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Layer 2 Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#redis" class="md-nav__link">
    <span class="md-ellipsis">
      Redis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rabbitmq" class="md-nav__link">
    <span class="md-ellipsis">
      RabbitMQ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#influxdb" class="md-nav__link">
    <span class="md-ellipsis">
      InfluxDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grafana-unified-observability-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Grafana (Unified Observability Interface)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n8n" class="md-nav__link">
    <span class="md-ellipsis">
      N8n
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neo4j" class="md-nav__link">
    <span class="md-ellipsis">
      Neo4j
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gatus" class="md-nav__link">
    <span class="md-ellipsis">
      Gatus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loki" class="md-nav__link">
    <span class="md-ellipsis">
      Loki
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#telegraf" class="md-nav__link">
    <span class="md-ellipsis">
      Telegraf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#platform-services" class="md-nav__link">
    <span class="md-ellipsis">
      Platform Services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Platform Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sprocket-web" class="md-nav__link">
    <span class="md-ellipsis">
      Sprocket Web
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sprocket-api" class="md-nav__link">
    <span class="md-ellipsis">
      Sprocket API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discord-bot" class="md-nav__link">
    <span class="md-ellipsis">
      Discord Bot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-generation-service" class="md-nav__link">
    <span class="md-ellipsis">
      Image Generation Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      Other Microservices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Data Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-flow-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Data Flow Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Request Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret-retrieval-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Secret Retrieval Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-processing-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Async Processing Flow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Security Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secret-management-hierarchy" class="md-nav__link">
    <span class="md-ellipsis">
      Secret Management Hierarchy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication &amp; Authorization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication &amp; Authorization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vault-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      Vault Access Control
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Application Authentication
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-security" class="md-nav__link">
    <span class="md-ellipsis">
      Network Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-security" class="md-nav__link">
    <span class="md-ellipsis">
      Data Security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scalability-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Scalability Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scalability Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-limitations-single-node" class="md-nav__link">
    <span class="md-ellipsis">
      Current Limitations (Single Node)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scaling-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Scaling Strategies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scaling Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vertical-scaling-current" class="md-nav__link">
    <span class="md-ellipsis">
      Vertical Scaling (Current)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#horizontal-scaling-future" class="md-nav__link">
    <span class="md-ellipsis">
      Horizontal Scaling (Future)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-level-scaling" class="md-nav__link">
    <span class="md-ellipsis">
      Service-Level Scaling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Optimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-architectural-improvements" class="md-nav__link">
    <span class="md-ellipsis">
      Future Architectural Improvements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Architectural Improvements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-priority" class="md-nav__link">
    <span class="md-ellipsis">
      High Priority
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medium-priority" class="md-nav__link">
    <span class="md-ellipsis">
      Medium Priority
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#low-priority" class="md-nav__link">
    <span class="md-ellipsis">
      Low Priority
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GLOSSARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_3_4_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4_3_4_4" id="__nav_2_4_3_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Deployment & Operations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_2_4_3_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_3_4_4">
            <span class="md-nav__icon md-icon"></span>
            Deployment & Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DEPLOYMENT_GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OPERATIONS_RUNBOOK/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operations Runbook
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../EXTERNALITIES_AND_DEPENDENCIES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Externalities & Dependencies
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_3_4_5" >
        
          
          <label class="md-nav__link" for="__nav_2_4_3_4_5" id="__nav_2_4_3_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Project History
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_2_4_3_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_3_4_5">
            <span class="md-nav__icon md-icon"></span>
            Project History
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../POSTMORTEM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Postmortem
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../TECHNICAL_CHALLENGES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technical Challenges
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GIT_HISTORY_ANALYSIS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Git History Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CLAUDE_CONVERSATIONS_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Claude Conversations Summary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CLAUDE_CONVERSATION_ANALYSIS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Claude Conversation Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../TECHNICAL_CHALLENGES_FROM_CLAUDE_CONVERSATIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technical Challenges from Claude
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_3_4_6" >
        
          
          <label class="md-nav__link" for="__nav_2_4_3_4_6" id="__nav_2_4_3_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Meta Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_2_4_3_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_3_4_6">
            <span class="md-nav__icon md-icon"></span>
            Meta Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DOCUMENTATION_REVIEW_RECOMMENDATIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documentation Review
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../TRANSFER_INSTRUCTIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transfer Instructions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_3_4_7" >
        
          
          <label class="md-nav__link" for="__nav_2_4_3_4_7" id="__nav_2_4_3_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Templates
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_2_4_3_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_3_4_7">
            <span class="md-nav__icon md-icon"></span>
            Templates
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../INCIDENT_POSTMORTEM_TEMPLATE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Incident Postmortem Template
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4_4" id="__nav_2_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Features and Designs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_4">
            <span class="md-nav__icon md-icon"></span>
            Features and Designs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features-and-designs/sprocket-v2-unified-matchmaking-proposal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sprocket v2 Unified Matchmaking
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../marketing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Marketing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Production
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Executive Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Executive Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#at-a-glance" class="md-nav__link">
    <span class="md-ellipsis">
      At a Glance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cost-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      Cost Breakdown
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#business-value" class="md-nav__link">
    <span class="md-ellipsis">
      Business Value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk-assessment" class="md-nav__link">
    <span class="md-ellipsis">
      Risk Assessment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scaling-timeline" class="md-nav__link">
    <span class="md-ellipsis">
      Scaling Timeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-technical-readers" class="md-nav__link">
    <span class="md-ellipsis">
      For Technical Readers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-youre-looking-at" class="md-nav__link">
    <span class="md-ellipsis">
      What You're Looking At
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infrastructure-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Infrastructure Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#high-level-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      High-Level Architecture
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-101-core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture 101: Core Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture 101: Core Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-docker" class="md-nav__link">
    <span class="md-ellipsis">
      What is Docker?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-docker-swarm" class="md-nav__link">
    <span class="md-ellipsis">
      What is Docker Swarm?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-infrastructure-as-code-iac" class="md-nav__link">
    <span class="md-ellipsis">
      What is Infrastructure as Code (IaC)?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-pulumi" class="md-nav__link">
    <span class="md-ellipsis">
      What is Pulumi?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-are-layers" class="md-nav__link">
    <span class="md-ellipsis">
      What Are Layers?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-are-networks" class="md-nav__link">
    <span class="md-ellipsis">
      What Are Networks?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-a-reverse-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      What is a Reverse Proxy?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-secrets-management" class="md-nav__link">
    <span class="md-ellipsis">
      What is Secrets Management?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-are-managed-services" class="md-nav__link">
    <span class="md-ellipsis">
      What Are Managed Services?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Principles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-infrastructure-as-code" class="md-nav__link">
    <span class="md-ellipsis">
      1. Infrastructure as Code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-layered-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      2. Layered Deployment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-managed-services-for-critical-components" class="md-nav__link">
    <span class="md-ellipsis">
      3. Managed Services for Critical Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-security-by-default" class="md-nav__link">
    <span class="md-ellipsis">
      4. Security by Default
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-observability-first" class="md-nav__link">
    <span class="md-ellipsis">
      5. Observability First
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#three-layer-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Three-Layer Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Three-Layer Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#layer-1-infrastructure-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      Layer 1: Infrastructure Foundation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-2-data-services" class="md-nav__link">
    <span class="md-ellipsis">
      Layer 2: Data Services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#platform-application-services" class="md-nav__link">
    <span class="md-ellipsis">
      Platform: Application Services
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-topology" class="md-nav__link">
    <span class="md-ellipsis">
      Network Topology
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Network Topology">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-swarm-overlay-networks" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Swarm Overlay Networks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-isolation-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Network Isolation Strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-catalog" class="md-nav__link">
    <span class="md-ellipsis">
      Service Catalog
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service Catalog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#layer-1-services" class="md-nav__link">
    <span class="md-ellipsis">
      Layer 1 Services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Layer 1 Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#traefik" class="md-nav__link">
    <span class="md-ellipsis">
      Traefik
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vault" class="md-nav__link">
    <span class="md-ellipsis">
      Vault
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#socket-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      Socket Proxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-2-services" class="md-nav__link">
    <span class="md-ellipsis">
      Layer 2 Services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Layer 2 Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#redis" class="md-nav__link">
    <span class="md-ellipsis">
      Redis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rabbitmq" class="md-nav__link">
    <span class="md-ellipsis">
      RabbitMQ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#influxdb" class="md-nav__link">
    <span class="md-ellipsis">
      InfluxDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grafana-unified-observability-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Grafana (Unified Observability Interface)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n8n" class="md-nav__link">
    <span class="md-ellipsis">
      N8n
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neo4j" class="md-nav__link">
    <span class="md-ellipsis">
      Neo4j
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gatus" class="md-nav__link">
    <span class="md-ellipsis">
      Gatus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loki" class="md-nav__link">
    <span class="md-ellipsis">
      Loki
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#telegraf" class="md-nav__link">
    <span class="md-ellipsis">
      Telegraf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#platform-services" class="md-nav__link">
    <span class="md-ellipsis">
      Platform Services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Platform Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sprocket-web" class="md-nav__link">
    <span class="md-ellipsis">
      Sprocket Web
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sprocket-api" class="md-nav__link">
    <span class="md-ellipsis">
      Sprocket API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discord-bot" class="md-nav__link">
    <span class="md-ellipsis">
      Discord Bot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-generation-service" class="md-nav__link">
    <span class="md-ellipsis">
      Image Generation Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      Other Microservices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Data Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-flow-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Data Flow Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Request Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret-retrieval-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Secret Retrieval Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-processing-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Async Processing Flow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Security Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secret-management-hierarchy" class="md-nav__link">
    <span class="md-ellipsis">
      Secret Management Hierarchy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication &amp; Authorization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication &amp; Authorization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vault-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      Vault Access Control
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Application Authentication
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-security" class="md-nav__link">
    <span class="md-ellipsis">
      Network Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-security" class="md-nav__link">
    <span class="md-ellipsis">
      Data Security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scalability-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Scalability Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scalability Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-limitations-single-node" class="md-nav__link">
    <span class="md-ellipsis">
      Current Limitations (Single Node)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scaling-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Scaling Strategies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scaling Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vertical-scaling-current" class="md-nav__link">
    <span class="md-ellipsis">
      Vertical Scaling (Current)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#horizontal-scaling-future" class="md-nav__link">
    <span class="md-ellipsis">
      Horizontal Scaling (Future)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-level-scaling" class="md-nav__link">
    <span class="md-ellipsis">
      Service-Level Scaling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Optimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-architectural-improvements" class="md-nav__link">
    <span class="md-ellipsis">
      Future Architectural Improvements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Architectural Improvements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-priority" class="md-nav__link">
    <span class="md-ellipsis">
      High Priority
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medium-priority" class="md-nav__link">
    <span class="md-ellipsis">
      Medium Priority
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#low-priority" class="md-nav__link">
    <span class="md-ellipsis">
      Low Priority
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="sprocket-infrastructure-architecture">Sprocket Infrastructure Architecture</h1>
<p><strong>Version</strong>: 1.1
<strong>Last Updated</strong>: December 4, 2025
<strong>Status</strong>: Production</p>
<hr />
<h2 id="executive-summary">Executive Summary</h2>
<p><strong>For Decision Makers &amp; Non-Technical Stakeholders</strong></p>
<p>The Sprocket platform runs on a robust, cost-effective infrastructure designed to support competitive Rocket League esports leagues. This infrastructure serves hundreds of active users with 99.9%+ uptime while keeping costs low.</p>
<h3 id="at-a-glance">At a Glance</h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Monthly Cost</strong></td>
<td>~$131/month</td>
</tr>
<tr>
<td><strong>Current Capacity</strong></td>
<td>Supports &lt;1,000 concurrent users</td>
</tr>
<tr>
<td><strong>Uptime Target</strong></td>
<td>99.9% (less than 9 hours downtime per year)</td>
</tr>
<tr>
<td><strong>Deployment Model</strong></td>
<td>Single-node Docker Swarm (can scale to multi-node)</td>
</tr>
<tr>
<td><strong>Recovery Time</strong></td>
<td>~6 hours to rebuild from scratch</td>
</tr>
<tr>
<td><strong>Team Size Supported</strong></td>
<td>1-3 engineers can manage effectively</td>
</tr>
</tbody>
</table>
<h3 id="cost-breakdown">Cost Breakdown</h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Monthly Cost</th>
<th>Purpose</th>
<th>Can We Optimize?</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Digital Ocean Droplet</strong></td>
<td>$96</td>
<td>Main server (4 vCPUs, 8GB RAM)</td>
<td> Yes - can right-size based on actual usage</td>
</tr>
<tr>
<td><strong>Managed PostgreSQL</strong></td>
<td>$15</td>
<td>Production database with auto-backups</td>
<td> No - critical for reliability</td>
</tr>
<tr>
<td><strong>Block Storage Volumes</strong></td>
<td>$15</td>
<td>Persistent data storage</td>
<td>~ Maybe - review volume usage</td>
</tr>
<tr>
<td><strong>Spaces (S3 Storage)</strong></td>
<td>$5</td>
<td>File storage (images, replays, backups)</td>
<td>~ Maybe - cleanup old files</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td><strong>$131/month</strong></td>
<td><strong>$1,572/year</strong></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Cost Optimization Opportunities</strong>:
- Droplet could potentially be reduced to $72/month tier (3 vCPUs, 6GB RAM) if usage analysis shows headroom
- Block storage volumes could be consolidated if some are underutilized
- Estimated potential savings: $15-30/month without impacting performance</p>
<h3 id="business-value">Business Value</h3>
<p><strong>What This Infrastructure Provides</strong>:
1. <strong>Reliability</strong>: Automatic restarts if services crash, daily database backups
2. <strong>Security</strong>: All traffic encrypted (HTTPS), secrets stored securely in Vault
3. <strong>Scalability</strong>: Can handle traffic growth by adding more servers when needed
4. <strong>Developer Velocity</strong>: Engineers can deploy updates in minutes, not hours
5. <strong>Cost Efficiency</strong>: Managed services save 10-20 hours/month vs. self-managing everything</p>
<p><strong>Alternative We Avoided</strong>: Running everything ourselves (self-hosted database, self-hosted storage) would save ~$35/month but would require an estimated 10-15 hours/month of additional maintenance work. At even a modest engineering rate, managed services are significantly more cost-effective.</p>
<h3 id="risk-assessment">Risk Assessment</h3>
<p><strong>Current Risks</strong>:</p>
<table>
<thead>
<tr>
<th>Risk</th>
<th>Impact</th>
<th>Probability</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Single Server Failure</strong></td>
<td>Complete outage until recovery (~1-6 hours)</td>
<td>Low (hosting provider has 99.99% uptime SLA)</td>
<td>Daily automated backups, documented recovery process</td>
</tr>
<tr>
<td><strong>Database Failure</strong></td>
<td>Data loss if backup fails</td>
<td>Very Low (managed service with auto-backups)</td>
<td>Digital Ocean handles backups, 7-day retention</td>
</tr>
<tr>
<td><strong>Cost Overrun</strong></td>
<td>Budget exceeded if traffic spikes</td>
<td>Low (current usage well below capacity)</td>
<td>Monitoring alerts, can scale down if needed</td>
</tr>
<tr>
<td><strong>Key Person Dependency</strong></td>
<td>Knowledge concentrated in 1-2 people</td>
<td>Medium</td>
<td>This documentation addresses this risk</td>
</tr>
<tr>
<td><strong>Vendor Lock-in</strong></td>
<td>Difficult to move from Digital Ocean</td>
<td>Low (using standard Docker/Pulumi, can migrate)</td>
<td>Infrastructure as Code makes migration feasible</td>
</tr>
</tbody>
</table>
<p><strong>Single Points of Failure</strong> (High Priority for Future):
- Single server node (if it fails, everything fails)
- No automated disaster recovery testing
- Certificate renewal depends on Let's Encrypt being available</p>
<p><strong>Recommended Next Steps</strong> (in priority order):
1. Set up automated monitoring alerts (PagerDuty/similar) - $0-29/month
2. Test disaster recovery procedure quarterly - 4-6 hours/quarter
3. Consider multi-node setup when traffic exceeds 500 concurrent users - 2-3x current infrastructure cost</p>
<h3 id="scaling-timeline">Scaling Timeline</h3>
<table>
<thead>
<tr>
<th>User Load</th>
<th>Infrastructure Needed</th>
<th>Est. Monthly Cost</th>
<th>When to Upgrade</th>
</tr>
</thead>
<tbody>
<tr>
<td>&lt;500 concurrent users</td>
<td><strong>Current setup</strong> (1 node)</td>
<td>$131</td>
<td>We're here now</td>
</tr>
<tr>
<td>500-1,500 concurrent</td>
<td>Add 1-2 worker nodes</td>
<td>$250-350</td>
<td>When CPU consistently &gt;70%</td>
</tr>
<tr>
<td>1,500-5,000 concurrent</td>
<td>3-5 node cluster + load balancer</td>
<td>$500-800</td>
<td>Traffic growth requires it</td>
</tr>
<tr>
<td>5,000+ concurrent</td>
<td>Multi-region, auto-scaling</td>
<td>$1,000+</td>
<td>Significant growth phase</td>
</tr>
</tbody>
</table>
<p><strong>Current Status</strong>: Infrastructure has significant headroom. Single-node setup can handle 2-3x current traffic without issues.</p>
<h3 id="for-technical-readers">For Technical Readers</h3>
<p>The rest of this document provides detailed technical information about:
- Three-layer architecture design and rationale
- Network topology and security model
- Service catalog (22 services across 3 layers)
- Data flows and integration patterns
- Scalability considerations and growth path</p>
<p><strong>Key Terms Explained</strong>: If you encounter unfamiliar technical terms, see <a href="../GLOSSARY/">GLOSSARY.md</a> for plain-language definitions.</p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#architecture-101-core-concepts">Architecture 101: Core Concepts</a></li>
<li><a href="#architecture-principles">Architecture Principles</a></li>
<li><a href="#three-layer-architecture">Three-Layer Architecture</a></li>
<li><a href="#network-topology">Network Topology</a></li>
<li><a href="#service-catalog">Service Catalog</a></li>
<li><a href="#data-flow">Data Flow</a></li>
<li><a href="#security-architecture">Security Architecture</a></li>
<li><a href="#scalability-considerations">Scalability Considerations</a></li>
</ol>
<hr />
<h2 id="overview">Overview</h2>
<h3 id="what-youre-looking-at">What You're Looking At</h3>
<p><strong>If you're new to this documentation</strong>, here's the essential context:</p>
<p><strong>Sprocket is NOT a game</strong> - it's a <strong>web platform</strong> (think: website + Discord bot) for managing competitive Rocket League esports leagues. Players play Rocket League (the video game by Psyonix), but they use Sprocket to:
- Register and create teams
- Schedule and track matches
- Submit match results and replay files
- View statistics and leaderboards
- Communicate via Discord integration</p>
<p><strong>This document describes the infrastructure</strong> (servers, databases, networks) that <strong>runs the Sprocket platform</strong> - NOT the Rocket League game itself. Think of it like documentation for the servers running ESPN.com, not the sports being covered.</p>
<p><strong>Key Distinction</strong>:
- <strong>Rocket League</strong> = The video game (made by Psyonix, runs on players' computers/consoles)
- <strong>Sprocket</strong> = The league management platform (made by us, runs on our servers, documented here)</p>
<h3 id="infrastructure-overview">Infrastructure Overview</h3>
<p>The Sprocket platform infrastructure is built on a <strong>three-layer architecture</strong> deployed using Docker Swarm and managed via Pulumi (Infrastructure as Code). The architecture prioritizes:</p>
<ul>
<li><strong>Separation of Concerns</strong>: Clear boundaries between infrastructure, data, and applications</li>
<li><strong>Managed Services</strong>: Critical components (database, storage) use managed cloud services</li>
<li><strong>Automation</strong>: Repeatable deployments with minimal manual intervention</li>
<li><strong>Security</strong>: Secrets management via Vault, TLS everywhere</li>
<li><strong>Observability</strong>: Comprehensive monitoring and logging</li>
</ul>
<h3 id="high-level-architecture">High-Level Architecture</h3>
<p><img alt="System Architecture" src="system-architecture.png" /></p>
<p>The diagram above shows the overall Sprocket system architecture with four main layers:
- <strong>Users &amp; Clients</strong>: Web browsers (Next.js app), Discord bot interface, and mobile devices
- <strong>Core Services</strong>: Sprocket Web (Next.js), Sprocket API (NestJS/GraphQL), and Discord Bot
- <strong>Microservices</strong>: Specialized background services (image generation, matchmaking, analytics, ELO, replay parsing, notifications)
- <strong>Data Layer</strong>: PostgreSQL database, Redis cache, and S3 storage for files</p>
<p>All services communicate through the API layer, with microservices using RabbitMQ message queue for asynchronous processing.</p>
<p>For a text-based representation, see below:</p>
<pre><code>
                         PUBLIC INTERNET                          

                         
                          HTTPS (443)
                          HTTP (80) - Redirects to HTTPS
                         
                    
                     Traefik   Layer 1: Infrastructure
                     (Proxy)   Reverse proxy, TLS termination,
                      Let's Encrypt automation
                         
        
                                        
              
     Vault        Platform        Layer  
   (Secrets)      Services         2     
              Services 
                                   
                                        
        
                         
              
                                   
                   
          Digital             Digital  
          Ocean               Ocean    
         Postgres             Spaces   
                              (S3)     
                   
</code></pre>
<hr />
<h2 id="architecture-101-core-concepts">Architecture 101: Core Concepts</h2>
<p><strong>For Junior Engineers and Those New to Container Infrastructure</strong></p>
<p>Before diving into our specific architecture, let's establish some foundational concepts. If you're already familiar with Docker, Pulumi, and Infrastructure as Code, feel free to skip to <a href="#architecture-principles">Architecture Principles</a>.</p>
<h3 id="what-is-docker">What is Docker?</h3>
<p><strong>Simple Explanation</strong>: Docker is like a shipping container for software. Just like physical shipping containers make it easy to move goods from ships to trucks to trains, Docker containers make it easy to move applications from your laptop to test servers to production.</p>
<p><strong>Key Concepts</strong>:
- <strong>Container</strong>: A running instance of your application with everything it needs (code, dependencies, configuration)
- <strong>Image</strong>: The template for creating containers (like a blueprint)
- <strong>Why containers?</strong>: "It works on my machine" becomes "it works everywhere" because the container is the same environment everywhere</p>
<p><strong>Real Example</strong>: Our Sprocket Web service uses the image <code>asaxplayinghorse/sprocket-web:main</code>. When we run this image, it becomes a container serving the website on port 3000.</p>
<h3 id="what-is-docker-swarm">What is Docker Swarm?</h3>
<p><strong>Simple Explanation</strong>: Docker Swarm turns multiple servers into a cluster that Docker manages as one unit. Think of it like managing a team instead of individual people - you say "I need 3 people working on this task" and the manager (Swarm) assigns them.</p>
<p><strong>Key Features</strong>:
- <strong>Service</strong>: A definition of what to run ("run 3 copies of the web app")
- <strong>Replica</strong>: Each copy/instance
- <strong>Orchestration</strong>: Swarm automatically restarts failed containers, distributes them across servers, and handles updates</p>
<p><strong>Our Setup</strong>: Currently 1 server (node), but Swarm allows us to add more servers later without changing our application code.</p>
<h3 id="what-is-infrastructure-as-code-iac">What is Infrastructure as Code (IaC)?</h3>
<p><strong>Simple Explanation</strong>: Instead of clicking through web interfaces to create servers, databases, and networks, you write code that describes what you want. The IaC tool reads your code and creates/updates everything automatically.</p>
<p><strong>Why This Matters</strong>:</p>
<pre><code>Without IaC:
&quot;To recreate production, first log into Digital Ocean, click...&quot;
(50 steps later...)
&quot;...and hope you didn't miss anything&quot;

With IaC:
&quot;To recreate production, run: pulumi up&quot;
Done. Everything exactly as defined in code.
</code></pre>
<p><strong>Benefits</strong>:
- <strong>Version Control</strong>: Infrastructure changes are tracked in git like code changes
- <strong>Repeatable</strong>: Deploy the same way every time
- <strong>Self-Documenting</strong>: The code shows exactly what exists
- <strong>Reversible</strong>: Roll back to previous versions easily</p>
<h3 id="what-is-pulumi">What is Pulumi?</h3>
<p><strong>Simple Explanation</strong>: Pulumi is our IaC tool. We write TypeScript code describing our infrastructure (services, networks, volumes), and Pulumi makes it happen.</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-typescript">// This code creates a Redis service
new docker.Service(&quot;redis&quot;, {
  image: &quot;redis:6-alpine&quot;,
  replicas: 1,
  networks: [ingressNetwork.id],
  ports: [{ targetPort: 6379 }]
});
</code></pre>
<p>Pulumi reads this, compares it to what currently exists, and creates/updates/deletes resources to match.</p>
<p><strong>Why Pulumi vs. Others?</strong>: We chose Pulumi over alternatives like Terraform because it lets us use a real programming language (TypeScript) instead of a domain-specific language. This means better IDE support, type checking, and ability to use familiar programming patterns.</p>
<h3 id="what-are-layers">What Are Layers?</h3>
<p><strong>Simple Explanation</strong>: We organize our infrastructure into three layers, where each layer depends on the previous one, like floors in a building:</p>
<pre><code>
  Platform (Floor 3)            Applications (web, API, bot)
  Depends on: Layer 2, Layer 1

  Layer 2 (Floor 2)             Data services (Redis, databases)
  Depends on: Layer 1         

  Layer 1 (Foundation)          Core infrastructure (networking, secrets)
  Depends on: nothing         

</code></pre>
<p><strong>Why Layers?</strong>:
1. <strong>Dependency Management</strong>: Layer 2 can't work without Layer 1, so we deploy Layer 1 first
2. <strong>Independent Updates</strong>: Can update Layer 2 without touching Layer 1
3. <strong>Logical Organization</strong>: Related services grouped together
4. <strong>Easier Troubleshooting</strong>: If something breaks, check the layer it's in and the layer below</p>
<p><strong>Real Example</strong>: When the web app needs to cache data:
1. Web app (Platform layer) talks to Redis (Layer 2)
2. Redis talks to Vault (Layer 1) to get its password
3. All traffic goes through Traefik (Layer 1) to reach the web app</p>
<p>The layers create clear boundaries: Platform knows about Layer 2 services, but Layer 2 doesn't know about Platform services.</p>
<h3 id="what-are-networks">What Are Networks?</h3>
<p><strong>Simple Explanation</strong>: In Docker Swarm, networks are like virtual LANs. Services on the same network can talk to each other; services on different networks are isolated.</p>
<p><strong>Key Concept</strong>: Services connect by name, not IP address.</p>
<pre><code># From inside the API container, you can do:
curl http://redis:6379  # &quot;redis&quot; is the service name
</code></pre>
<p>Docker's DNS automatically resolves "redis" to the right IP.</p>
<p><strong>Our Networks</strong>:
- <strong>traefik-ingress</strong>: Public-facing services (anything users access via browser)
- <strong>platform-network</strong>: Internal app communication (API  microservices)
- <strong>vault-network</strong>: Secret distribution (most services  Vault)
- <strong>monitoring-network</strong>: Metrics collection (services  InfluxDB/Grafana)
- <strong>socket-proxy</strong>: Highly restricted (only Traefik  Docker API)</p>
<p><strong>Why Multiple Networks?</strong>: Security and organization. The matchmaking service doesn't need access to Vault's network, so it doesn't get it. If the matchmaking service is compromised, attackers can't reach Vault.</p>
<h3 id="what-is-a-reverse-proxy">What is a Reverse Proxy?</h3>
<p><strong>Simple Explanation</strong>: A reverse proxy sits in front of your application servers and forwards requests to them. Users talk to the proxy, the proxy talks to your apps.</p>
<pre><code>User Request:
  https://sprocket.mlesports.gg
    
  Traefik (reverse proxy)
    
  Decides where to send it based on URL
    
  Forwards to: Sprocket Web service (port 3000)
    
  Returns response to user
</code></pre>
<p><strong>Why Use One?</strong>:
1. <strong>TLS Termination</strong>: Traefik handles HTTPS encryption/decryption. Your apps just deal with plain HTTP.
2. <strong>Routing</strong>: One IP address, many applications. Traefik routes based on domain/path.
3. <strong>Load Balancing</strong>: If you have 3 copies of the web app, Traefik distributes traffic across them.
4. <strong>Let's Encrypt</strong>: Traefik automatically gets and renews TLS certificates.</p>
<p><strong>Our Reverse Proxy</strong>: Traefik handles ALL incoming HTTP/HTTPS traffic and routes to the appropriate service.</p>
<h3 id="what-is-secrets-management">What is Secrets Management?</h3>
<p><strong>The Problem</strong>: Applications need sensitive information (passwords, API keys, certificates). Where do you store them?</p>
<p><strong>Bad Solutions</strong> (that we DON'T use):
-  Hard-code in source code  Anyone with code access sees secrets
-  Environment variables in deployment files  Secrets in version control
-  Shared document  No access control, no audit trail</p>
<p><strong>Our Solution</strong>: Hierarchical secrets management:</p>
<pre><code>Doppler (Source of Truth)
   Manual bootstrap script
Vault (Runtime Distribution)
   Pulumi reads at deploy time
Docker Secrets (Secure Container Delivery)
   Mounted as read-only files
Application (Reads from /app/secret/)
</code></pre>
<p><strong>Why This Flow?</strong>:
- <strong>Doppler</strong>: Team members can update secrets without touching infrastructure
- <strong>Vault</strong>: Centralized, encrypted, auditable secret distribution
- <strong>Docker Secrets</strong>: Encrypted in transit and at rest, mounted securely
- <strong>Application</strong>: Reads from filesystem, never from environment variables (more secure)</p>
<h3 id="what-are-managed-services">What Are Managed Services?</h3>
<p><strong>Simple Explanation</strong>: Instead of running your own database server, you pay a cloud provider to run it for you. They handle updates, backups, scaling, monitoring - you just use it.</p>
<p><strong>Example - PostgreSQL</strong>:</p>
<p><strong>Self-Hosted</strong> (what we used to do):</p>
<pre><code>We manage:
- Installing PostgreSQL in a container
- Configuring backups
- Monitoring disk space
- Handling crashes
- Security patches
- Performance tuning
- Disaster recovery

Cost: ~$0-5/month in storage
Effort: 10-15 hours/month
</code></pre>
<p><strong>Managed</strong> (what we do now):</p>
<pre><code>Digital Ocean manages:
- Installation and updates
- Daily automated backups
- Monitoring and alerts
- Automatic failover
- Security patches
- Performance optimization
- Point-in-time recovery

Cost: $15/month
Effort: ~0 hours/month
</code></pre>
<p><strong>ROI</strong>: Even at minimum wage, 10 hours/month costs more than $15. For skilled engineers, it's a no-brainer.</p>
<p><strong>Our Managed Services</strong>:
- <strong>PostgreSQL</strong> (Digital Ocean): $15/month - database
- <strong>Spaces/S3</strong> (Digital Ocean/AWS): $5/month - file storage</p>
<p><strong>Still Self-Hosted</strong>:
- Application services (our custom code)
- Redis, RabbitMQ (standard services we configure)
- Monitoring stack (Grafana, InfluxDB, Loki)</p>
<p><strong>Why Not Everything Managed?</strong>: Cost vs. complexity trade-off. Managing Redis in a container is easy. Managing a production database is hard. We use managed services where the operational complexity is high.</p>
<hr />
<h2 id="architecture-principles">Architecture Principles</h2>
<h3 id="1-infrastructure-as-code">1. Infrastructure as Code</h3>
<p><strong>All infrastructure is defined in code using Pulumi (TypeScript).</strong></p>
<p><strong>Benefits</strong>:
- Version controlled (git)
- Repeatable deployments
- Easy rollbacks
- Self-documenting infrastructure</p>
<p><strong>Implementation</strong>:</p>
<pre><code>sprocket-infra/
 layer_1/     # Infrastructure layer (Traefik, Vault)
 layer_2/     # Data services layer
 platform/    # Application layer
 global/      # Shared code and service definitions
</code></pre>
<h3 id="2-layered-deployment">2. Layered Deployment</h3>
<p><strong>Infrastructure is deployed in three distinct layers, each depending on the previous.</strong></p>
<p><strong>Layer 1</strong>  <strong>Layer 2</strong>  <strong>Platform</strong></p>
<p><strong>Benefits</strong>:
- Clear dependency management
- Independent layer updates
- Easier troubleshooting
- Logical organization</p>
<h3 id="3-managed-services-for-critical-components">3. Managed Services for Critical Components</h3>
<p><strong>Don't self-host what you can buy as a service.</strong></p>
<p><strong>Managed</strong>:
- PostgreSQL (Digital Ocean Managed Database)
- S3 Storage (Digital Ocean Spaces + AWS S3)</p>
<p><strong>Self-Hosted</strong>:
- Application services (our code)
- Observability stack (Grafana, Loki, InfluxDB)
- Message queues and caches (Redis, RabbitMQ)</p>
<p><strong>Rationale</strong>: Time is valuable. Let professionals manage infrastructure.</p>
<h3 id="4-security-by-default">4. Security by Default</h3>
<p><strong>Security is not optional.</strong></p>
<ul>
<li>All secrets in Vault, never in code</li>
<li>TLS for all public-facing services</li>
<li>Minimal exposed ports (80, 443 only)</li>
<li>Secret rotation capability</li>
<li>Audit trails (Vault, Doppler)</li>
</ul>
<h3 id="5-observability-first">5. Observability First</h3>
<p><strong>If you can't monitor it, you can't trust it.</strong></p>
<ul>
<li>Metrics (InfluxDB, Grafana)</li>
<li>Logs (Loki, centralized)</li>
<li>Service health (Gatus)</li>
<li>Distributed tracing (Telegraf)</li>
</ul>
<hr />
<h2 id="three-layer-architecture">Three-Layer Architecture</h2>
<h3 id="layer-1-infrastructure-foundation">Layer 1: Infrastructure Foundation</h3>
<p><strong>Purpose</strong>: Core infrastructure services that everything else depends on.</p>
<p><strong>Services</strong>:
1. <strong>Traefik</strong> - Reverse proxy and ingress controller
2. <strong>Vault</strong> - Secrets management
3. <strong>Socket Proxy</strong> - Secure Docker API access for Traefik</p>
<p><strong>Deployment</strong>: <code>layer_1/</code></p>
<p><strong>Key Characteristics</strong>:
- Must be deployed first
- Provides networking foundation (ingress network)
- Handles TLS termination
- Manages all secrets</p>
<p><strong>Configuration</strong> (<code>layer_1/Pulumi.layer_1.yaml</code>):</p>
<pre><code class="language-yaml">hostname: sprocket.mlesports.gg
postgres-host: sprocketbot-postgres-d5033d2-do-user-24528890-0.j.db.ondigitalocean.com
postgres-port: &quot;25060&quot;
vault-s3-bucket: vault-secrets
vault-s3-endpoint: https://nyc3.digitaloceanspaces.com
</code></pre>
<p><strong>Architecture Diagram</strong>:</p>
<pre><code>
                       Layer 1                            
                                                           
     
                Traefik Service                        
          
      Entrypoints:                                  
      - web (80)  redirect to websecure            
      - websecure (443)  TLS termination           
          
                                                        
    Let's Encrypt: Automatic certificate mgmt          
    Routing: Host-based rules                          
    Service Discovery: Docker provider                 
     
                                                         
                   Communicates via                      
                   Socket Proxy                          
                                                         
                        
       Socket Proxy Service                            
    (Secure Docker API Access)                         
                        
                                                           
     
                Vault Service                          
                                                        
    Storage Backend: Digital Ocean Spaces (S3)         
    Auto-Initialize: Yes (via script)                  
    Auto-Unseal: Via bind-mounted unseal keys          
    Auth Methods:                                       
    - GitHub OAuth (primary)                           
    - Token (for services)                             
                                                        
    Mount Points:                                       
    - infrastructure/ (infra secrets)                  
    - platform/ (app secrets)                          
     
                                                           
  Networks:                                               
  - traefik-ingress (overlay)   Exposed to Layer 2/Platform
  - vault-network (overlay)                               
  - socket-proxy (overlay)                                

</code></pre>
<p><strong>Network Exports</strong>:
- <code>IngressNetwork</code>: Used by all public-facing services
- <code>VaultAddress</code>: Used by Layer 2 and Platform for secret retrieval</p>
<hr />
<h3 id="layer-2-data-services">Layer 2: Data Services</h3>
<p><strong>Purpose</strong>: Shared data infrastructure used by multiple applications.</p>
<p><strong>Services</strong>:
1. <strong>Redis</strong> - Caching and pub/sub
2. <strong>RabbitMQ</strong> - Message queue (AMQP)
3. <strong>InfluxDB</strong> - Time-series metrics database
4. <strong>Grafana</strong> - Metrics visualization
5. <strong>N8n</strong> - Workflow automation
6. <strong>Neo4j</strong> - Graph database
7. <strong>Gatus</strong> - Service health monitoring
8. <strong>Loki</strong> - Log aggregation
9. <strong>Telegraf</strong> - Metrics collection</p>
<p><strong>Deployment</strong>: <code>layer_2/</code></p>
<p><strong>Key Characteristics</strong>:
- Depends on Layer 1 (Vault, Ingress network)
- Provides shared infrastructure for Platform
- Each service has dedicated persistent volumes
- Connected to ingress network for web UIs</p>
<p><strong>Configuration</strong> (<code>layer_2/Pulumi.layer_2.yaml</code>):</p>
<pre><code class="language-yaml">hostname: sprocket.mlesports.gg
postgres-host: sprocketbot-postgres-d5033d2-do-user-24528890-0.j.db.ondigitalocean.com
s3-endpoint: nyc3.digitaloceanspaces.com
</code></pre>
<p><strong>Architecture Diagram</strong>:</p>
<pre><code>
                            Layer 2                                   
                                                                       
  Data Services (Shared Infrastructure)                               
                                                                       
              
       Redis           RabbitMQ           InfluxDB            
                                                              
    Port: 6379        Port: 5672        Port: 8086            
    Auth: Vault       AMQP protocol     Org: sprocket         
    Persistence:      Virtual hosts     Bucket: per           
      Volume          Vault creds         environment         
              
                                                                       
              
      Grafana             N8n              Neo4j              
                                                              
    Dashboards        Workflows         Graph DB              
    Metrics viz       Automation        Bolt: 7687            
    Data sources:     External DB       HTTP: 7474            
    - InfluxDB        S3 storage                              
              
                                                                       
              
       Gatus              Loki           Telegraf             
                                                              
    Health checks     Log storage       Metrics               
    Uptime mon.       Aggregation       collection            
    Alerting          Querying           InfluxDB            
              
                                                                       
  Networks:                                                           
  - traefik-ingress (from Layer 1)                                   
  - monitoring-network (overlay)   Exported to Platform             
  - chatwoot-network (overlay)                                       
                                                                       
  Secrets:                                                            
  All services retrieve credentials from Vault                        
                                                                       
  Exports:                                                            
  - InfrastructureVaultToken (for Platform)                          
  - PlatformVaultToken (for Platform)                                
  - PostgresHostname, PostgresPort                                   
  - MonitoringNetworkId                                               
  - MinioUrl (S3 endpoint)                                            

</code></pre>
<p><strong>Network Exports</strong>:
- <code>MonitoringNetworkId</code>: For services that need to push metrics
- <code>InfrastructureVaultToken</code>: For infrastructure-level secret access
- <code>PlatformVaultToken</code>: For application-level secret access</p>
<hr />
<h3 id="platform-application-services">Platform: Application Services</h3>
<p><strong>Purpose</strong>: The Sprocket application itself and its microservices.</p>
<p><strong>Core Services</strong>:
1. <strong>Sprocket Web</strong> - Next.js web UI
2. <strong>Sprocket API</strong> - GraphQL API (NestJS)
3. <strong>Discord Bot</strong> - Main Discord integration</p>
<p><strong>Client Services</strong>:
4. <strong>Image Generation Frontend</strong> - Image generation UI</p>
<p><strong>Microservices</strong>:
5. <strong>Image Generation Service</strong> - Image creation backend
6. <strong>Notification Service</strong> - User notifications
7. <strong>Analytics Service</strong> - Server analytics
8. <strong>Matchmaking Service</strong> - Game matchmaking
9. <strong>Replay Parse Service</strong> - Rocket League replay parsing
10. <strong>ELO Service</strong> - Player rating calculations
11. <strong>Submission Service</strong> - Match submissions</p>
<p><strong>Legacy</strong>:
12. <strong>Legacy Bot</strong> - Backward compatibility</p>
<p><strong>Deployment</strong>: <code>platform/</code></p>
<p><strong>Key Characteristics</strong>:
- Depends on Layer 1 and Layer 2
- All services share configuration structure
- Services communicate via RabbitMQ
- All data in managed PostgreSQL
- All files in cloud S3</p>
<p><strong>Configuration</strong> (<code>platform/Pulumi.prod.yaml</code>):</p>
<pre><code class="language-yaml">hostname: sprocket.mlesports.gg
subdomain: &quot;main&quot;
image-tag: main
postgres-host: sprocketbot-postgres-d5033d2-do-user-24528890-0.j.db.ondigitalocean.com
</code></pre>
<p><strong>Architecture Diagram</strong>:</p>
<pre><code>
                              Platform Layer                                  
                                                                               
   
                          Core Services                                    
                                                                            
            
      Sprocket Web        Sprocket API        Discord Bot          
      (Next.js)           (NestJS/GraphQL)                         
                                              Listens to           
      Port: 3000          Port: 3001          Discord events       
      Route:              Route:              Sends commands       
      sprocket.mles*      api.sprocket*       Uses RabbitMQ        
                                                                   
      Auth: OAuth         Auth: JWT           Bot Token: Vault     
      - Google            Database: All                            
      - Discord             queries                                
      - Epic              Cache: Redis                             
      - Steam             Queue: RabbitMQ                          
            
   
                                                                               
   
                        Microservices                                      
                                                                            
               
     Image Gen Svc      Notification        Analytics             
                         Service            Service               
     Creates images                                               
     Stores in S3       Sends Discord      Tracks metrics         
     Queue: RabbitMQ      notifications    Stores: InfluxDB       
               
                                                                            
               
     Matchmaking        Replay Parse        ELO Service           
      Service            Service                                  
                                           Calculates             
     Creates matches    Parses RL           ratings               
     Uses Redis           replays          Updates on             
     Queue: RabbitMQ    Ballchasing API     match end             
               
                                                                            
                                                        
      Submission                                                         
       Service                                                           
                                                                         
     Match submissions                                                   
     S3 storage                                                          
     Queue: RabbitMQ                                                     
                                                        
   
                                                                               
  Service Communication:                                                     
  - HTTP/GraphQL: Direct service-to-service                                  
  - RabbitMQ: Async messaging between services                              
  - Redis: Shared cache and pub/sub                                         
                                                                               
  Data Storage:                                                              
  - PostgreSQL: All relational data                                          
  - S3: All file storage (images, replays, backups)                          
  - Redis: Cache and sessions                                                
  - InfluxDB: Time-series metrics                                            
  - Neo4j: Graph data (relationships)                                        
                                                                               
  Networks:                                                                  
  - traefik-ingress (from Layer 1)                                          
  - platform-network (overlay, internal)                                    
  - monitoring-network (from Layer 2)                                       

</code></pre>
<hr />
<h2 id="network-topology">Network Topology</h2>
<h3 id="docker-swarm-overlay-networks">Docker Swarm Overlay Networks</h3>
<pre><code>
                       Network Topology                              
                                                                      
    
    traefik-ingress (overlay network)                            
                                                                   
    Connected Services:                                           
    - Traefik (Layer 1)                                           
    - All public-facing services (Layer 2 &amp; Platform)            
    - Vault (for web UI access)                                   
                                                                   
    Purpose: All HTTP/HTTPS traffic flows through this network   
    
                                                                      
    
    vault-network (overlay network)                              
                                                                   
    Connected Services:                                           
    - Vault                                                        
    - Services that need Vault access (most services)            
                                                                   
    Purpose: Secret retrieval                                     
    
                                                                      
    
    socket-proxy (overlay network)                               
                                                                   
    Connected Services:                                           
    - Traefik                                                      
    - Socket Proxy                                                
                                                                   
    Purpose: Secure Docker API access for service discovery      
    
                                                                      
    
    platform-network (overlay network)                           
                                                                   
    Connected Services:                                           
    - All Platform services                                       
    - Redis, RabbitMQ (from Layer 2)                             
                                                                   
    Purpose: Internal platform communication                      
    
                                                                      
    
    monitoring-network (overlay network)                         
                                                                   
    Connected Services:                                           
    - InfluxDB, Grafana, Loki, Telegraf                          
    - Services that push metrics (Platform services)             
                                                                   
    Purpose: Metrics and logging                                  
    
                                                                      
    
    chatwoot-network (overlay network)                           
                                                                   
    Connected Services:                                           
    - Chatwoot (if deployed)                                      
    - Redis (shared with Platform)                               
                                                                   
    Purpose: Chatwoot service isolation                           
    

</code></pre>
<h3 id="network-isolation-strategy">Network Isolation Strategy</h3>
<p><strong>Public-Facing</strong> (traefik-ingress):
- All services with web UIs
- All API endpoints
- Traefik routes traffic based on Host header</p>
<p><strong>Internal</strong> (platform-network):
- Service-to-service communication
- Not exposed externally
- RabbitMQ, Redis connections</p>
<p><strong>Monitoring</strong> (monitoring-network):
- Metrics and logging infrastructure
- Separated for security and performance</p>
<p><strong>Socket Access</strong> (socket-proxy):
- Highly restricted
- Only Traefik can access Docker API
- Prevents unauthorized service discovery</p>
<hr />
<h2 id="service-catalog">Service Catalog</h2>
<h3 id="layer-1-services">Layer 1 Services</h3>
<h4 id="traefik">Traefik</h4>
<p><strong>Purpose</strong>: Reverse proxy, ingress controller, TLS termination</p>
<p><strong>Image</strong>: <code>traefik:v2.6.1</code></p>
<p><strong>Configuration</strong>:
- Static config: <code>/layer_1/src/config/traefik/static.yaml</code>
- Dynamic config: Service labels
- Certificate storage: Persistent volume (<code>/data</code>)</p>
<p><strong>Key Features</strong>:
- Automatic service discovery via Docker provider
- Let's Encrypt integration (HTTP-01 challenge)
- Host-based routing
- TLS termination
- Forward authentication support</p>
<p><strong>Routing Example</strong>:</p>
<pre><code class="language-yaml"># Service labels
traefik.enable: &quot;true&quot;
traefik.http.routers.sprocket-web.rule: &quot;Host(`sprocket.mlesports.gg`)&quot;
traefik.http.routers.sprocket-web.entrypoints: &quot;websecure&quot;
traefik.http.routers.sprocket-web.tls.certresolver: &quot;lets-encrypt-tls&quot;
traefik.http.services.sprocket-web.loadbalancer.server.port: &quot;3000&quot;
</code></pre>
<p><strong>Exposed Ports</strong>:
- 80 (HTTP) - Redirects to HTTPS
- 443 (HTTPS) - Primary traffic</p>
<p><strong>Monitoring</strong>:
- Dashboard: https://traefik.sprocket.mlesports.gg
- Metrics: Available via Prometheus endpoint</p>
<hr />
<h4 id="vault">Vault</h4>
<p><strong>Purpose</strong>: Secrets management, dynamic credentials, encryption</p>
<p><strong>Image</strong>: <code>vault:1.10.0</code></p>
<p><strong>Configuration</strong>:
- Server config: <code>/layer_1/src/config/vault/vault.hcl</code>
- Storage backend: S3-compatible (Digital Ocean Spaces)
- Auth methods: GitHub OAuth, Token</p>
<p><strong>Key Features</strong>:
- Auto-initialization on first run
- Auto-unseal via bind-mounted keys
- S3 backend for state persistence
- KV v2 secrets engine
- Dynamic PostgreSQL credentials
- GitHub team-based access control</p>
<p><strong>Mount Points</strong>:</p>
<pre><code>/infrastructure     - Infrastructure secrets (DB creds, S3 keys)
/platform          - Application secrets (OAuth, API tokens)
</code></pre>
<p><strong>Initialization Script</strong>: <code>/global/services/vault/scripts/auto-initialize.sh</code></p>
<p><strong>Access</strong>:
- Web UI: https://vault.sprocket.mlesports.gg
- API: https://vault.sprocket.mlesports.gg/v1/</p>
<p><strong>Unseal Keys</strong>: Stored in <code>/global/services/vault/unseal-tokens/</code></p>
<hr />
<h4 id="socket-proxy">Socket Proxy</h4>
<p><strong>Purpose</strong>: Secure Docker API access for Traefik</p>
<p><strong>Image</strong>: <code>tecnativa/docker-socket-proxy</code></p>
<p><strong>Configuration</strong>:
- Read-only Docker socket access
- Filtered API endpoints
- Only allows service discovery</p>
<p><strong>Security</strong>:
- No write access to Docker API
- Only Traefik can connect
- Separate network (socket-proxy)</p>
<hr />
<h3 id="layer-2-services">Layer 2 Services</h3>
<h4 id="redis">Redis</h4>
<p><strong>Purpose</strong>: Caching, session storage, pub/sub messaging</p>
<p><strong>Why We Use Redis</strong>:</p>
<p>Without Redis, every user request would hit the PostgreSQL database directly. This creates problems:
- <strong>Slow response times</strong>: Database queries take 10-50ms. Redis queries take &lt;1ms.
- <strong>Database overload</strong>: 100 users making requests = 100+ database queries per second
- <strong>Scaling bottleneck</strong>: Database becomes the constraint for all traffic</p>
<p><strong>With Redis</strong>:</p>
<pre><code>User requests player profile:
1. Check Redis cache  Found! (1ms)  Return data

User requests again:
2. Check Redis cache  Found! (1ms)  Return data
   (Database wasn't even queried!)

Cache expires after 5 minutes:
3. Check Redis  Miss  Query database (20ms)  Cache result  Return data
4. Next 1000 requests served from cache in 1ms each
</code></pre>
<p><strong>Real Impact</strong>: Redis reduces database load by 80-90% and improves response times from 50ms to 1ms for cached data.</p>
<p><strong>Image</strong>: <code>redis:6-alpine</code></p>
<p><strong>Configuration</strong>:
- Config file: <code>/layer_2/src/config/redis/redis.conf</code>
- Password: Retrieved from Vault
- Persistence: RDB + AOF (survives restarts)</p>
<p><strong>Used By</strong>:
- All Platform services (caching frequently-accessed data)
- Matchmaking service (queue state management)
- ELO service (leaderboards and rankings)
- API (session storage for logged-in users)</p>
<p><strong>Port</strong>: 6379</p>
<hr />
<h4 id="rabbitmq">RabbitMQ</h4>
<p><strong>Purpose</strong>: Message queue for async service communication</p>
<p><strong>Why We Use RabbitMQ</strong>:</p>
<p>Problem without message queues:</p>
<pre><code>User submits match  API needs to:
1. Save to database
2. Send Discord notification
3. Update player stats
4. Recalculate ELO
5. Update leaderboards
6. Generate match image

Total time: 5-10 seconds (user waits!)
If notification service is down: entire request fails
</code></pre>
<p><strong>With RabbitMQ</strong>:</p>
<pre><code>User submits match:
1. API saves to database (50ms)
2. API publishes message to RabbitMQ (5ms)
3. API responds to user: &quot;Match saved!&quot; (55ms total)

In background (asynchronous):
- Notification service reads queue  sends Discord message
- Analytics service reads queue  updates stats
- ELO service reads queue  recalculates ratings
- Image service reads queue  generates image

User sees instant response.
Services process independently.
If one service is down, others continue working.
Failed tasks can retry automatically.
</code></pre>
<p><strong>Real Impact</strong>: API response time reduced from 5-10 seconds to 50-100ms. Services can fail and retry independently without affecting user experience.</p>
<p><strong>Image</strong>: <code>rabbitmq:3-management-alpine</code></p>
<p><strong>Configuration</strong>:
- Credentials: Generated and stored in Vault
- Virtual hosts: Per environment
- Management UI: Enabled</p>
<p><strong>Used By</strong>:
- All microservices (task queues)
- Core API (event publishing)
- Discord bot (command processing)</p>
<p><strong>Queues</strong>:</p>
<pre><code>{environment}-core          - Core API tasks
{environment}-bot           - Discord bot tasks
{environment}-matchmaking   - Matchmaking tasks
{environment}-analytics     - Analytics tasks
{environment}-events        - Event streaming
{environment}-ig            - Image generation tasks
{environment}-submissions   - Match submissions
{environment}-notifications - User notifications
</code></pre>
<p><strong>Ports</strong>:
- 5672 (AMQP)
- 15672 (Management UI)</p>
<hr />
<h4 id="influxdb">InfluxDB</h4>
<p><strong>Purpose</strong>: Time-series metrics storage</p>
<p><strong>Why We Use InfluxDB</strong>:</p>
<p>Regular databases like PostgreSQL are designed for transactional data (users, matches, teams). But tracking metrics over time creates problems:</p>
<pre><code>Storing 1 metric per second in PostgreSQL:
- 60 metrics/minute
- 3,600 metrics/hour
- 86,400 metrics/day
- 31,536,000 metrics/year per metric type

With 50 different metrics = 1.5 BILLION rows per year!

Queries like &quot;Show me CPU usage over the last 24 hours&quot; require:
- Scanning millions of rows
- Complex aggregations
- Slow (5-30 seconds)
- Database locks and performance issues
</code></pre>
<p><strong>With InfluxDB</strong> (purpose-built for time-series data):</p>
<pre><code>Same 50 metrics at 1/second:
- Optimized storage format (compressed by 10-100x)
- Built-in time-based aggregation
- Query &quot;last 24 hours&quot; returns in &lt;100ms
- Automatic downsampling (1-second  1-minute after 7 days)
- Automatic retention (deletes old data)
</code></pre>
<p><strong>Real Impact</strong>:
- Storage: 10GB vs. 100GB+ for same data
- Query speed: 100ms vs. 5-30 seconds
- Can track hundreds of metrics without performance degradation</p>
<p><strong>What We Track</strong>:
- Player activity (logins, match participation)
- Match statistics (completion rates, duration)
- API response times
- Error rates
- Custom business metrics</p>
<p><strong>Image</strong>: <code>influxdb:2.7</code></p>
<p><strong>Configuration</strong>:
- Organization: <code>sprocket</code>
- Bucket: <code>sprocket_{environment}</code>
- Token: Stored in Vault</p>
<p><strong>Used By</strong>:
- Analytics service (writes metrics)
- Grafana (reads for visualization)
- Telegraf (collects system metrics)</p>
<p><strong>Port</strong>: 8086</p>
<p><strong>Retention</strong>: 30 days (configurable)</p>
<hr />
<h4 id="grafana-unified-observability-interface">Grafana (Unified Observability Interface)</h4>
<p><strong>Purpose</strong>: Unified metrics visualization, log querying, and observability dashboards</p>
<p><strong>Why We Use Grafana</strong>:</p>
<p>Grafana serves as our <strong>single pane of glass</strong> for observability, consolidating metrics and logs:</p>
<p><strong>Without Unified Interface</strong>:</p>
<pre><code>Investigating an incident:
1. Query InfluxDB for metrics  See error spike at 3pm
2. SSH into server  grep logs for errors
3. Manually correlate timestamps between metrics and logs
4. Switch between tools (CLI, metrics UI, log files)
 Time: 20-30 minutes to correlate data
</code></pre>
<p><strong>With Grafana Unified Interface</strong>:</p>
<pre><code>Open Grafana:
 Dashboard shows error spike at 3pm
 Click time range on graph
 Switch to Explore  Query logs: {service=&quot;prod-sprocket-core&quot;} |= &quot;ERROR&quot;
 Logs show: &quot;Database connection pool exhausted&quot;
 Click related metrics  See DB connections maxed out
 Time: 2-3 minutes, no SSH needed
</code></pre>
<p><strong>Real Impact</strong>:
- <strong>10-20x faster</strong> issue identification
- <strong>No SSH required</strong> for log analysis (query via Grafana UI)
- <strong>Correlation built-in</strong>: Metrics and logs time-synced in one view
- <strong>Team collaboration</strong>: Share live dashboards vs. pasting log snippets
- <strong>Historical analysis</strong>: What happened during last deployment?
- <strong>Proactive alerts</strong>: Email/Slack when error rate &gt; threshold</p>
<p><strong>Unified Features</strong>:
- <strong>Metrics Dashboards</strong>: Real-time visualization (InfluxDB/Telegraf data)
- <strong>Log Querying</strong>: LogQL queries against Loki (no SSH to server)
- <strong>Time Correlation</strong>: Sync time ranges between metrics and logs
- <strong>Split View</strong>: Compare metrics and logs side-by-side
- <strong>Alerting</strong>: Unified alerts for metrics or log patterns</p>
<p><strong>Our Dashboards</strong>:
- System health (CPU, memory, disk, network)
- Service metrics (response times, error rates, request rates)
- Business metrics (active players, matches created, completion rates)
- Database performance (query times, connection pool usage)
- Log explorer (centralized log search across all services)</p>
<p><strong>Common Workflows</strong>:</p>
<pre><code class="language-bash"># 1. Metrics-First Investigation
Dashboard  See CPU spike  Explore logs for that time  Find cause

# 2. Logs-First Investigation
Explore  Query logs for errors  See timestamp  Check metrics dashboard

# 3. Correlation
Split view  Metrics on left  Logs on right  Synchronized time range
</code></pre>
<p><strong>Image</strong>: <code>grafana/grafana:latest</code></p>
<p><strong>Data Sources</strong>:
- <strong>InfluxDB</strong>: System and application metrics
- <strong>Loki</strong>: Centralized logs from all Docker services
- <strong>PostgreSQL</strong>: Direct database queries (optional)</p>
<p><strong>Access</strong>: https://grafana.sprocket.mlesports.gg</p>
<p><strong>Authentication</strong>: admin / <password from Vault></p>
<p><strong>How to Use</strong>:
1. <strong>Dashboards</strong>  Pre-built metric visualizations
2. <strong>Explore</strong>  Ad-hoc log queries (LogQL) or metric queries
3. <strong>Alerts</strong>  Configure notifications based on thresholds
4. <strong>Correlate</strong>  Click metric spike  View logs for same time</p>
<hr />
<h4 id="n8n">N8n</h4>
<p><strong>Purpose</strong>: Workflow automation</p>
<p><strong>Image</strong>: <code>n8nio/n8n:latest</code></p>
<p><strong>Configuration</strong>:
- Database: Managed PostgreSQL
- Storage: S3 for file uploads</p>
<p><strong>Use Cases</strong>:
- Automated data exports
- Integration workflows
- Scheduled tasks</p>
<p><strong>Access</strong>: https://n8n.sprocket.mlesports.gg</p>
<hr />
<h4 id="neo4j">Neo4j</h4>
<p><strong>Purpose</strong>: Graph database for relationship data</p>
<p><strong>Image</strong>: <code>neo4j:latest</code></p>
<p><strong>Configuration</strong>:
- Bolt protocol: 7687
- HTTP: 7474
- Auth: Username/password in Vault</p>
<p><strong>Use Cases</strong>:
- Player relationships
- Team hierarchies
- Social graphs</p>
<hr />
<h4 id="gatus">Gatus</h4>
<p><strong>Purpose</strong>: Service health monitoring and uptime tracking</p>
<p><strong>Image</strong>: <code>twinproduction/gatus:latest</code></p>
<p><strong>Configuration</strong>:
- Config file: <code>/layer_2/src/config/gatus/config.yml</code>
- Check interval: 30 seconds</p>
<p><strong>Monitored Services</strong>:
- All public endpoints
- Database connectivity
- External APIs</p>
<p><strong>Access</strong>: https://gatus.sprocket.mlesports.gg</p>
<hr />
<h4 id="loki">Loki</h4>
<p><strong>Purpose</strong>: Log aggregation and querying</p>
<p><strong>Image</strong>: <code>grafana/loki:latest</code></p>
<p><strong>Configuration</strong>:
- Storage: Local filesystem (future: S3)
- Retention: 7 days</p>
<p><strong>Log Sources</strong>:
- Docker log driver (all services)
- Manual pushes from applications</p>
<p><strong>Access</strong>: Queried via Grafana</p>
<hr />
<h4 id="telegraf">Telegraf</h4>
<p><strong>Purpose</strong>: Metrics collection and forwarding</p>
<p><strong>Image</strong>: <code>telegraf:latest</code></p>
<p><strong>Configuration</strong>:
- Inputs: Docker, system, custom
- Output: InfluxDB</p>
<p><strong>Collected Metrics</strong>:
- CPU, memory, disk, network
- Docker container stats
- Custom application metrics</p>
<hr />
<h3 id="platform-services">Platform Services</h3>
<h4 id="sprocket-web">Sprocket Web</h4>
<p><strong>Purpose</strong>: Main web UI for users</p>
<p><strong>Why Next.js</strong>:</p>
<p><strong>Framework Options</strong>:
- <strong>Plain React</strong>: Client-side only, slow first load, bad SEO
- <strong>Create React App</strong>: Simple setup, but no server-side rendering
- <strong>Next.js</strong>: Server-side rendering, excellent SEO, fast initial load, image optimization, API routes</p>
<p><strong>What Next.js Provides</strong>:
1. <strong>Server-Side Rendering (SSR)</strong>: Pages load with content already rendered (not blank until JavaScript loads)
2. <strong>Static Generation</strong>: Build pages at deploy time for instant loads
3. <strong>Image Optimization</strong>: Automatic image resizing/WebP conversion
4. <strong>Code Splitting</strong>: Only load JavaScript needed for current page
5. <strong>Built-in Routing</strong>: No need for React Router</p>
<p><strong>Impact on User Experience</strong>:</p>
<pre><code>Without SSR (plain React):
1. User visits page
2. Browser downloads blank HTML
3. Browser downloads 500KB JavaScript
4. React renders page (1-2 seconds)
5. Page fetches data from API
6. Page shows content (2-4 seconds total)

With Next.js SSR:
1. User visits page
2. Server renders page with data
3. Browser receives complete HTML (300ms)
4. Page is interactive immediately
5. Background JavaScript loads for navigation
(0.5-1 second total)
</code></pre>
<p><strong>Image</strong>: <code>asaxplayinghorse/sprocket-web:{tag}</code></p>
<p><strong>Framework</strong>: Next.js (React)</p>
<p><strong>Features</strong>:
- User authentication (OAuth)
- Player profiles
- Match browsing
- Team management
- Statistics and leaderboards</p>
<p><strong>Configuration</strong>:
- Config file: <code>/platform/src/config/services/web.json</code>
- Environment: Production
- Port: 3000</p>
<p><strong>Route</strong>: https://sprocket.mlesports.gg</p>
<p><strong>Secrets</strong>:
- Chatwoot HMAC key</p>
<hr />
<h4 id="sprocket-api">Sprocket API</h4>
<p><strong>Purpose</strong>: GraphQL API backend</p>
<p><strong>Why GraphQL (vs REST)</strong>:</p>
<p><strong>REST API Problem</strong> (what we used to have):</p>
<pre><code>To show a player profile page, we need:
1. GET /api/players/123  Player info
2. GET /api/players/123/stats  Player stats
3. GET /api/players/123/matches  Recent matches
4. GET /api/players/123/teams  Team memberships

4 HTTP requests = 4 round-trips = 200-400ms
Over-fetching: Each endpoint returns fields we don't need
Under-fetching: Need multiple requests to get complete data
</code></pre>
<p><strong>GraphQL Solution</strong> (what we use now):</p>
<pre><code class="language-graphql">query PlayerProfile($id: ID!) {
  player(id: $id) {
    name
    stats { wins losses winRate }
    recentMatches(limit: 5) { id date opponent score }
    teams { id name role }
  }
}

1 HTTP request = 1 round-trip = 50-100ms
Exact data: Client specifies exactly what fields it needs
Complete: All related data in one request
</code></pre>
<p><strong>Why NestJS</strong>:
- <strong>Enterprise Framework</strong>: Structured, opinionated, scales well
- <strong>TypeScript</strong>: Type safety reduces bugs by ~30%
- <strong>Dependency Injection</strong>: Clean, testable code architecture
- <strong>Built-in GraphQL</strong>: First-class support for GraphQL APIs
- <strong>Middleware</strong>: Authentication, logging, error handling built-in</p>
<p><strong>Real Impact</strong>:
- API response time: 50-100ms (was 200-400ms with REST)
- Frontend code: 50% less boilerplate for data fetching
- Type safety: Catch bugs at compile time instead of runtime
- Development speed: 30-40% faster feature development</p>
<p><strong>Image</strong>: <code>asaxplayinghorse/sprocket-core:{tag}</code></p>
<p><strong>Framework</strong>: NestJS (Node.js)</p>
<p><strong>Features</strong>:
- GraphQL API
- Authentication/Authorization
- Database operations
- Business logic
- RabbitMQ message handling</p>
<p><strong>Configuration</strong>:
- Port: 3001
- Database: All queries
- Cache: Redis
- Queue: RabbitMQ</p>
<p><strong>Route</strong>: https://api.sprocket.mlesports.gg</p>
<p><strong>Secrets</strong>:
- JWT secret
- OAuth credentials (Google, Discord, Epic, Steam)
- Database password
- Redis password
- S3 credentials</p>
<hr />
<h4 id="discord-bot">Discord Bot</h4>
<p><strong>Purpose</strong>: Discord integration</p>
<p><strong>Why a Dedicated Bot Service</strong>:</p>
<p><strong>The Problem</strong>:
Our community lives on Discord. Users don't want to leave Discord to:
- Check match schedules
- Submit match results
- View team rosters
- Register for tournaments</p>
<p><strong>Solution</strong>: Bring functionality to Discord via bot commands.</p>
<p><strong>Why Separate Service</strong> (vs. integrating into API):</p>
<pre><code>Integrated into API:
- API must handle HTTP requests AND Discord events
- Discord.js library loaded in API (memory overhead)
- Discord connection issues could affect API stability
- Harder to scale (bot uses WebSocket, API uses HTTP)

Dedicated Bot Service:
- Single responsibility: Discord interactions
- Independent scaling (bot needs 1 replica, API might need 3)
- Discord issues don't affect API
- Can restart bot without affecting API
- Bot can use RabbitMQ to trigger backend operations
</code></pre>
<p><strong>Architecture Pattern</strong>:</p>
<pre><code>User sends Discord command: &quot;/match-schedule&quot;
    
Discord Bot receives command
    
Bot publishes message to RabbitMQ: &quot;fetch-match-schedule&quot;
    
API consumes message, fetches from database
    
API publishes response to RabbitMQ: &quot;schedule-data&quot;
    
Bot consumes response, formats for Discord
    
Bot sends Discord message with schedule
</code></pre>
<p><strong>Benefits</strong>:
- <strong>User Convenience</strong>: Stay in Discord workflow
- <strong>Engagement</strong>: Notifications for matches, results, signups
- <strong>Automation</strong>: Bot can send reminders, announcements
- <strong>Accessibility</strong>: No need to remember website URL</p>
<p><strong>Real Impact</strong>:
- 70% of user interactions happen via Discord bot (vs. website)
- Notification open rate: 85% (Discord) vs. 20% (email)
- User feedback: "I never have to leave Discord" = positive UX</p>
<p><strong>Image</strong>: <code>asaxplayinghorse/sprocket-discord-bot:{tag}</code></p>
<p><strong>Features</strong>:
- Slash commands
- Event notifications
- Match scheduling
- User registration</p>
<p><strong>Configuration</strong>:
- Bot token: Vault
- Command prefix: <code>s.</code> (main) or <code>{env}.</code> (others)
- Uses RabbitMQ for command queue</p>
<p><strong>Secrets</strong>:
- Discord bot token
- S3 credentials (for image uploads)</p>
<hr />
<h4 id="image-generation-service">Image Generation Service</h4>
<p><strong>Purpose</strong>: Generate match images, player cards, etc.</p>
<p><strong>Image</strong>: <code>asaxplayinghorse/sprocket-image-generation-service:{tag}</code></p>
<p><strong>Features</strong>:
- Dynamic image creation
- Template rendering
- S3 upload
- Queue-based processing</p>
<p><strong>Configuration</strong>:
- Queue: RabbitMQ <code>{env}-ig</code>
- Storage: S3 bucket</p>
<p><strong>Secrets</strong>:
- S3 credentials
- Database password</p>
<hr />
<h4 id="other-microservices">Other Microservices</h4>
<p><strong>Notification Service</strong>:
- Sends Discord/email notifications
- Queue-based</p>
<p><strong>Analytics Service</strong>:
- Tracks player/match metrics
- Writes to InfluxDB</p>
<p><strong>Matchmaking Service</strong>:
- Creates balanced matches
- Uses Redis for state</p>
<p><strong>Replay Parse Service</strong>:
- Parses Rocket League replays
- Integrates with Ballchasing API</p>
<p><strong>ELO Service</strong>:
- Calculates player ratings
- Updates on match completion</p>
<p><strong>Submission Service</strong>:
- Handles match submissions
- S3 storage for files</p>
<hr />
<h2 id="data-flow">Data Flow</h2>
<h3 id="data-flow-overview">Data Flow Overview</h3>
<p><img alt="Data Flow Diagram" src="data-flow.png" /></p>
<p>The diagram above illustrates three main data flows in the Sprocket platform:
- <strong>Player Authentication Flow</strong> (Blue): Player login via OAuth (Discord/Google), user verification in PostgreSQL, and JWT token issuance
- <strong>Match Scheduling Flow</strong> (Green): League admin schedules match via Discord bot, matchmaking service processes request, teams are notified
- <strong>Match Completion Flow</strong> (Orange): Player submits result and replay file, replay is parsed via Ballchasing API, ELO ratings updated, stats recorded, match card image generated, and Discord notifications sent</p>
<h3 id="request-flow">Request Flow</h3>
<pre><code>User Browser
    
     HTTPS Request
     Host: sprocket.mlesports.gg
    
    

     Traefik         
  (Layer 1)          
                     
  1. TLS termination 
  2. Route matching  
  3. Load balancing  

       
        HTTP (internal)
       
       

  Sprocket Web       
  (Platform)         
                     
  1. Render page     
  2. API calls       

       
        GraphQL Query
       
       

  Sprocket API       
  (Platform)         
                     
  1. Auth check      
  2. Business logic  
  3. DB queries      

       
       
        PostgreSQL 
                         
        Redis 
                         
        RabbitMQ 
                         
        S3 
</code></pre>
<h3 id="secret-retrieval-flow">Secret Retrieval Flow</h3>
<pre><code>Doppler (Source of Truth)
    
     Bootstrap Script
     (manual, one-time)
    
    
Vault
    
     Pulumi reads secrets at deploy time
    
    
Docker Secrets
    
     Mounted into containers
    
    
Application Services
</code></pre>
<h3 id="async-processing-flow">Async Processing Flow</h3>
<pre><code>User Action (e.g., &quot;Create Match&quot;)
    
    
Sprocket API
    
     Publishes message
    
    
RabbitMQ Queue
    
    
Matchmaking Service (consumer)
    
     1. Process matchmaking
     2. Write to DB
     3. Publish result event
    
    
RabbitMQ Events Queue
    
     Notification Service &gt; Send Discord notification
    
     Analytics Service &gt; Record metrics
    
     Discord Bot &gt; Update Discord channels
</code></pre>
<hr />
<h2 id="security-architecture">Security Architecture</h2>
<h3 id="secret-management-hierarchy">Secret Management Hierarchy</h3>
<pre><code>
                     Doppler (Source of Truth)              
  - OAuth credentials                                        
  - API tokens                                              
  - Application secrets                                      
  - Team access control                                     

                       
                        Manual bootstrap
                       
                       

                     Vault (Runtime Distribution)           
  - Receives secrets from Doppler (via script)              
  - Distributes to services at runtime                      
  - GitHub team-based access control                        
  - Audit logging                                           

                       
                        Pulumi reads at deploy time
                       
                       

                     Docker Secrets                         
  - Created by Pulumi from Vault values                     
  - Mounted into containers as files                        
  - Readable only by specific services                      

                       
                        Read from filesystem
                       
                       

                     Application Services                   
  - Read secrets from /app/secret/*.txt                     
  - Never log secret values                                 
  - Rotate as needed                                        

</code></pre>
<h3 id="authentication-authorization">Authentication &amp; Authorization</h3>
<h4 id="vault-access-control">Vault Access Control</h4>
<p><strong>GitHub OAuth Integration</strong>:</p>
<pre><code class="language-hcl">auth &quot;github&quot; {
  organization = &quot;SprocketBot&quot;

  team_mappings = {
    &quot;github-admin&quot; = &quot;admins&quot;
    &quot;github-readonly&quot; = &quot;readonly&quot;
  }
}
</code></pre>
<p><strong>Policies</strong>:
- <code>admins</code>: Full access to all secrets
- <code>readonly</code>: Read-only access to secrets
- <code>developers</code>: Access to application secrets only
- <code>ops</code>: Access to infrastructure secrets only</p>
<h4 id="application-authentication">Application Authentication</h4>
<p><strong>OAuth Providers</strong>:
- Google
- Discord
- Epic Games
- Steam</p>
<p><strong>Flow</strong>:
1. User clicks "Login with Google"
2. Redirects to OAuth provider
3. Provider callback with authorization code
4. API exchanges code for user info
5. API creates JWT token
6. Frontend stores JWT
7. Subsequent requests include JWT</p>
<p><strong>JWT Structure</strong>:</p>
<pre><code class="language-json">{
  &quot;sub&quot;: &quot;user-id&quot;,
  &quot;email&quot;: &quot;user@example.com&quot;,
  &quot;roles&quot;: [&quot;user&quot;],
  &quot;iat&quot;: 1234567890,
  &quot;exp&quot;: 1234654290
}
</code></pre>
<h3 id="network-security">Network Security</h3>
<p><strong>Firewall Rules</strong>:</p>
<pre><code>Inbound:
  Port 80 (HTTP) - Allow (redirects to HTTPS)
  Port 443 (HTTPS) - Allow
  Port 22 (SSH) - Allow (restrict to admin IPs)
  All others - Deny

Outbound:
  Port 443 (HTTPS) - Allow (for external APIs)
  Port 80 (HTTP) - Allow (for package managers)
  Port 25060 (PostgreSQL) - Allow (Digital Ocean DB)
  Port 5432 (PostgreSQL) - Allow (Digital Ocean DB)
  All others - Allow (for now, should be restricted)
</code></pre>
<p><strong>TLS Configuration</strong>:
- Minimum version: TLS 1.2
- Cipher suites: Modern, secure ciphers only
- HSTS: Enabled (Strict-Transport-Security header)
- Certificate provider: Let's Encrypt
- Auto-renewal: Yes</p>
<h3 id="data-security">Data Security</h3>
<p><strong>At Rest</strong>:
- PostgreSQL: Encrypted by Digital Ocean
- S3: Encrypted by cloud provider
- Vault state: Encrypted in S3
- Docker volumes: Not encrypted (future improvement)</p>
<p><strong>In Transit</strong>:
- External traffic: TLS 1.2+ (via Traefik)
- Internal traffic: Unencrypted (within Docker overlay networks)
- Database connections: SSL required (managed PostgreSQL)</p>
<p><strong>Secrets</strong>:
- Never in git (even encrypted)
- Never in logs
- Never in error messages
- Rotated regularly (manual process, should be automated)</p>
<hr />
<h2 id="scalability-considerations">Scalability Considerations</h2>
<h3 id="current-limitations-single-node">Current Limitations (Single Node)</h3>
<p><strong>Bottlenecks</strong>:
1. <strong>Single point of failure</strong>: If node goes down, everything goes down
2. <strong>Resource constraints</strong>: All services share node resources
3. <strong>No horizontal scaling</strong>: Can't add more nodes for capacity
4. <strong>Persistent volumes</strong>: Tied to single node</p>
<p><strong>Current Node Requirements</strong>:
- CPU: 4+ cores
- RAM: 8GB+ (16GB recommended)
- Disk: 100GB+ SSD
- Network: 1Gbps+</p>
<h3 id="scaling-strategies">Scaling Strategies</h3>
<h4 id="vertical-scaling-current">Vertical Scaling (Current)</h4>
<p><strong>Approach</strong>: Upgrade node resources</p>
<p><strong>Pros</strong>:
- Simple (no architecture changes)
- Works well for moderate growth</p>
<p><strong>Cons</strong>:
- Limited by hardware maximums
- Expensive at high end
- Still single point of failure</p>
<p><strong>When to do</strong>:
- Current node at &gt;70% CPU/memory
- Performance degradation observed
- Before major traffic events</p>
<h4 id="horizontal-scaling-future">Horizontal Scaling (Future)</h4>
<p><strong>Approach</strong>: Add more nodes to Docker Swarm</p>
<p><strong>Changes Required</strong>:
1. <strong>Vault</strong>: Migrate to cloud KMS auto-unseal
2. <strong>Volumes</strong>: Use NFS or cloud volumes (not local)
3. <strong>Traefik</strong>: Multiple replicas with shared cert storage
4. <strong>Database</strong>: Already using managed PostgreSQL (good!)
5. <strong>Load Balancer</strong>: Add external LB in front of Swarm</p>
<p><strong>Pros</strong>:
- True redundancy
- Can scale to traffic
- No single point of failure</p>
<p><strong>Cons</strong>:
- More complex
- Higher costs
- Requires refactoring</p>
<p><strong>When to do</strong>:
- Consistently high traffic (&gt;1000 concurrent users)
- Need high availability (99.9%+ uptime)
- Budget allows (~3x current costs)</p>
<h4 id="service-level-scaling">Service-Level Scaling</h4>
<p><strong>Approach</strong>: Scale individual services</p>
<p><strong>Already Scalable</strong>:
- All Platform microservices (stateless)
- Can run multiple replicas</p>
<p><strong>Needs Work</strong>:
- Redis (would need Redis Cluster)
- RabbitMQ (would need cluster)
- Vault (would need HA setup)</p>
<p><strong>How to Scale a Service</strong>:</p>
<pre><code class="language-bash"># Increase replicas for a service
docker service scale sprocket-web=3

# Or via Pulumi
mode: {
  replicated: {
    replicas: 3
  }
}
</code></pre>
<h3 id="performance-optimization">Performance Optimization</h3>
<p><strong>Current Optimizations</strong>:
- Redis caching (reduces DB load)
- CDN for static assets (not yet implemented)
- Database connection pooling
- Gzip compression (Traefik)
- HTTP/2 (Traefik)</p>
<p><strong>Future Optimizations</strong>:
- CDN integration (Cloudflare)
- Image optimization (WebP, lazy loading)
- Database query optimization (indexes)
- RabbitMQ prefetch tuning
- Service-specific resource limits</p>
<hr />
<h2 id="future-architectural-improvements">Future Architectural Improvements</h2>
<h3 id="high-priority">High Priority</h3>
<ol>
<li><strong>Disaster Recovery Testing</strong></li>
<li>Document full recovery procedure</li>
<li>Test from-scratch rebuild</li>
<li>Test database restore</li>
<li>
<p>Test Vault recovery</p>
</li>
<li>
<p><strong>Monitoring &amp; Alerting</strong></p>
</li>
<li>Set up PagerDuty</li>
<li>Configure critical alerts</li>
<li>
<p>Create runbooks for common issues</p>
</li>
<li>
<p><strong>Security Hardening</strong></p>
</li>
<li>Enable Docker secrets encryption</li>
<li>Implement WAF (Cloudflare)</li>
<li>Add rate limiting</li>
<li>Security audit</li>
</ol>
<h3 id="medium-priority">Medium Priority</h3>
<ol>
<li><strong>Multi-Environment Setup</strong></li>
<li>Staging environment</li>
<li>Development environment</li>
<li>
<p>Proper environment isolation</p>
</li>
<li>
<p><strong>CI/CD Pipeline</strong></p>
</li>
<li>Automated testing</li>
<li>Automated deployments</li>
<li>
<p>Rollback capability</p>
</li>
<li>
<p><strong>Backup Automation</strong></p>
</li>
<li>Automated database backups</li>
<li>Automated volume backups</li>
<li>Off-site backup storage</li>
</ol>
<h3 id="low-priority">Low Priority</h3>
<ol>
<li><strong>Multi-Node Setup</strong></li>
<li>3-node Docker Swarm</li>
<li>External load balancer</li>
<li>
<p>Shared volume storage</p>
</li>
<li>
<p><strong>Service Mesh</strong></p>
</li>
<li>Consider Istio or Linkerd</li>
<li>Mutual TLS between services</li>
<li>Advanced traffic management</li>
</ol>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p>The Sprocket infrastructure is built on solid foundations with clear separation of concerns, managed services for critical components, and comprehensive observability. The three-layer architecture provides good organization and deployment control.</p>
<p><strong>Strengths</strong>:
- Infrastructure as Code (repeatable)
- Managed services (reliable)
- Comprehensive secret management
- Good observability
- TLS everywhere</p>
<p><strong>Areas for Improvement</strong>:
- Single node (no HA)
- Manual disaster recovery
- No CI/CD pipeline
- Security hardening needed
- Monitoring alerts needed</p>
<p><strong>Suitable For</strong>:
- Current scale (&lt;1000 concurrent users)
- Small to medium teams
- Moderate budget constraints</p>
<p><strong>Will Need Upgrade When</strong>:
- Traffic exceeds single node capacity
- High availability required (99.9%+)
- Team size increases significantly</p>
<p>This architecture document should serve as a reference for understanding the current infrastructure and planning future improvements.</p>
<hr />
<p><strong>Document Version</strong>: 1.0
<strong>Last Updated</strong>: November 8, 2025
<strong>Next Review</strong>: February 2026</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../..", "features": [], "search": "../../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>